generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model MallaCurricular {
  id                        String       @id @default(uuid())
  modalidad                 Modalidad
  tituloObtenido            String
  tipoDuracion              TipoDuracion
  fechaAprobacion           DateTime
  fechaLimiteVigencia       DateTime
  niveles                   Int
  maximoMateriasMatricula   Int
  cantidadLibreOpcionEgreso Int
  cantidadOptativasEgreso   Int
  cantidadArrastres         Int
  practicasLigadasMaterias  Boolean
  horasPractica             Int
  registroPracticasDesde    Int
  horasVinculacion          Int
  registroVinculacionDesde  Int
  registroProyectosDesde    Int
  usaNivelacion             Boolean
  plantillasSilabo          Boolean
  perfilEgreso              String?
  observaciones             String?
  createdAt                 DateTime     @default(now())

  asignaturaEnMalla AsignaturaEnMalla[]

  @@map("mallas_curriculares")
}

model Institucion {
  id        String          @id @default(uuid())
  nombre    String
  tipo      TipoInstitucion
  pais      String
  provincia String
  canton    String
  codigo    String
  titulos   Titulo[]
  createdAt DateTime        @default(now())

  @@map("instituciones")
}

enum Modalidad {
  VIRTUAL
  PRESENCIAL

  @@map("modalidad")
}

enum TipoDuracion {
  HORAS
  SEMANAS
  MESES
  ANOS

  @@map("tipo_duracion")
}

enum TipoInstitucion {
  FISCAL
  PARTICULAR

  @@map("tipo_institucion")
}

model Asignatura {
  id     String  @id @default(uuid())
  nombre String
  codigo String?

  asignaturaEnMalla AsignaturaEnMalla[]

  @@map("asignaturas")
}

model AsignaturaEnMalla {
  ejeFormativo              String
  nivel                     Int
  // ???????????????????????????????????????????
  areaConocimiento          String
  campoFormacion            String
  tipoAsignatura            String
  identificacion            String
  // ???????????????????????????????????????????
  permiteMatriculacion      Boolean
  validaCredito             Boolean
  validaPromedio            Boolean
  costoEnMatricula          Boolean
  practicasPreProfesionales Boolean
  requeridaEgreso           Boolean
  cantidadMatriculas        Int
  horasSemanales            Int
  horasColaborativas        Int
  horasAsistidasDocente     Int
  horasAutonomas            Int
  horasPracticas            Int
  creditos                  Float
  noValidaAsistencia        Boolean
  materiaComun              Boolean // ???????????????????????????????????????????
  objetivos                 String
  descripcion               String
  resultadosAprendizaje     String
  createdAt                 DateTime @default(now())

  asignaturaId String
  asignatura   Asignatura      @relation(fields: [asignaturaId], references: [id])
  mallaId      String
  malla        MallaCurricular @relation(fields: [mallaId], references: [id])

  @@id([asignaturaId, mallaId])
  @@map("asignaturas_en_mallas")
}

model Titulo {
  id     String @id @default(uuid())
  nombre String

  institucionId String?
  institucion   Institucion? @relation(fields: [institucionId], references: [id], onDelete: SetNull)

  @@map("titulos")
}

// pagina 45
// falta adicionar carreras - pagina 49
// falta asignaturas - pagina 49
// falta costos - pagina 49
model Curso {
  id          String  @id @default(uuid())
  estado      Boolean @default(true)
  nombre      String
  certificado String?
  alias       String?

  variantes VarianteCurso[]

  @@map("cursos")
}

// pagina 47
model VarianteCurso {
  id          String @id @default(uuid())
  nombre      String
  codigoBase  String
  descripcion String

  // registro
  registroExterno Boolean // permite registro externo en la pagina de la institucion
  registroInterno Boolean

  // verificar sesion y edad
  verificarSesion Boolean

  verificarEdad Boolean
  edadMinima    Int?
  edadMaxima    Int?

  cursoId String
  curso   Curso  @relation(fields: [cursoId], references: [id])

  @@map("variantes_de_cursos")
}
